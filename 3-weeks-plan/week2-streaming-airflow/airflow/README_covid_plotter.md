# COVID Barcode Plotter

This module generates barcode-style visualizations of COVID-19 metrics from the daily data produced by the COVID ETL DAG.

## Overview

The `covid_plotter.py` script reads COVID data from `/tmp/covid_summary.json` (generated by the `covid_etl_dag.py`) and creates a unique barcode visualization showing:

- **Red bars**: Total cases
- **Black bars**: Total deaths  
- **Green bars**: Total recovered

## Features

- Automatically reads data from the DAG output file
- Generates timestamp-based PNG filenames: `/tmp/covid_barcode_<YYYY-MM-DD>.png`
- Creates barcode-style visualization with normalized heights
- Includes summary statistics (mortality rate, recovery rate)
- Handles edge cases (zero values, missing timestamps)
- Provides error handling and informative messages

## Usage

### As a standalone script:
```bash
python3 covid_plotter.py
```

### As a Python module:
```python
from covid_plotter import read_covid_data, create_barcode_plot

# Read data
covid_data = read_covid_data('/tmp/covid_summary.json')

# Generate plot
output_file = create_barcode_plot(covid_data)
print(f"Plot saved to: {output_file}")
```

### Integration with Airflow DAG

The plotter can be integrated into the existing COVID ETL DAG by adding a task:

```python
from airflow.operators.python import PythonOperator
from covid_plotter import main as generate_plot

plot_task = PythonOperator(
    task_id='generate_barcode_plot',
    python_callable=generate_plot,
    provide_context=True,
)

# Add to DAG workflow
extract >> transform >> load >> plot_task
```

## Data Format

Expected JSON structure in `/tmp/covid_summary.json`:
```json
{
    "cases": 720450123,
    "deaths": 7654321,
    "recovered": 690123456,
    "updated": 1706529234567
}
```

## Output

- **File**: `/tmp/covid_barcode_<YYYY-MM-DD>.png`
- **Format**: PNG image, 1800x900 pixels at 150 DPI
- **Content**: Barcode visualization with legend, statistics, and grid

## Dependencies

- matplotlib
- numpy
- json (built-in)
- datetime (built-in)
- os (built-in)

## Error Handling

- Missing data file: Provides clear error message
- Zero values: Handles gracefully with flat visualization
- Missing timestamp: Uses current time as fallback
- Invalid data: Validates and provides informative errors